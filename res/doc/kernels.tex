\chapter{Kernel functions}

\section{Derivatives of kernels depending on the source-receiver distance}

In lots of useful cases (homogeneous and isotropic media) the kernel is distance-dependent: $K({\bf x}, {\bf y}) = G(|{\bf y} - {\bf x}|)$.
In these cases the kernel's normal derivatives can be expressed in a unified way.

Derivatives of the distance vector are given by the following formulas
%
\begin{align}
	r &= |{\bf r}| \\
	r'_i &= \frac{r_i}{r} \\
	r''_{ij} &= \frac{1}{r} \left( \delta_{ij} - r'_i r'_j \right) \\
	r'''_{ijk} &= -\frac{1}{r^2} \left(
		\delta_{ij} r'_k + \delta_{jk} r'_i + \delta_{ki} r'_j - 3 r'_i r'_j r'_k
	\right)
\end{align}

Derivatives of the kernel depending on the distance are formulated as
%
\begin{align}
	G'_i &= G'_r r'_i \\
	G''_{ij} &= \left(G''_r - \frac{G'_r}{r} \right) r'_i r'_j +  \frac{G'_r}{r} \delta_{ij} \\
	G'''_{ijk} &=
	\left(G'''_r -\frac{3}{r} \left(G''_r  - \frac{G'_r}{r} \right) \right) r'_i r'_j r'_k
	+  \frac{1}{r} \left( G''_r  - \frac{G'_r}{r} \right)\left(
	   r'_j \delta_{ki}
	+  r'_i \delta_{jk}
	+  r'_k \delta_{ij}
	\right)
	\label{eq:derivatives_wrt_ij}
\end{align}


The normal derivative w.r.t $n_y$ is computed as $G'_i n_{yi}$, while the normal derivative w.r.t. $n_x$ is computed as $-G'_i n_{xi}$:
%
\begin{align}
	\frac{\partial G}{\partial n_y} 
	&= n_{yi} G'_i
	\\
	\frac{\partial^2 G}{\partial n_x \partial n_y}
	&= -n_{xi} n_{yj} G''_{ij}
	\\
	\frac{\partial^2 G}{\partial n_x^2}
	&= n_{xi} n_{xj} G''_{ij}
	\\
	\frac{\partial^3 G}{\partial n_x^2 \partial n_y}
	&= n_{xi} n_{xj} n_{yk} G'''_{ijk}
\end{align}

\section{Laplace kernel in three dimensions}

The kernel expression is
%
\begin{equation}
	G({\bf x}, {\bf y}) = \frac{1}{4\pi r}
\end{equation}
%
The normal derivative w.r.t the normal at ${\bf y}$ is
%
\begin{equation}
	G'_{n_y} = \frac{-1}{4\pi r^2} \frac{{\bf r} \cdot {\bf n}_y}{r}
\end{equation}
%
The normal derivative w.r.t the normal at ${\bf x}$ is
%
\begin{equation}
	G'_{n_x} = \frac{-1}{4\pi r^2} \frac{-{\bf r} \cdot {\bf n}_x}{r}
\end{equation}
%
The second normal derivative is
%
\begin{multline}
	G''_{n_x n_y} = -n_{xi} n_{yj} G''_{ij}
	=-n_{xi} n_{yj} \left( \left(G''_r - \frac{G'_r}{r} \right) r'_i r'_j +  \frac{G'_r}{r} \delta_{ij} \right) \\
	=\frac{1}{4\pi} \cdot -n_{xi} n_{yj} \left( \frac{3}{r^3} r'_i r'_j - \frac{1}{r^3} \delta_{ij} \right)
	\\
	=\frac{1}{4\pi} \left(
		\frac{-n_{xi} r_i}{r} \frac{n_{yj} r_j}{r} \frac{3}{r^3}
		+
		\frac{n_{xk} n_{yk}}{r^3}
	\right)
\end{multline}

